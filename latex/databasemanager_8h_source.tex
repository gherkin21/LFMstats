\doxysection{databasemanager.\+h}
\hypertarget{databasemanager_8h_source}{}\label{databasemanager_8h_source}\mbox{\hyperlink{databasemanager_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{preprocessor}{\#ifndef\ DATABASEMANAGER\_H}}
\DoxyCodeLine{00002\ \textcolor{preprocessor}{\#define\ DATABASEMANAGER\_H}}
\DoxyCodeLine{00003\ }
\DoxyCodeLine{00004\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{scrobbledata_8h}{scrobbledata.h}}"{}}}
\DoxyCodeLine{00005\ \textcolor{preprocessor}{\#include\ <QAtomicInteger>}}
\DoxyCodeLine{00006\ \textcolor{preprocessor}{\#include\ <QDateTime>}}
\DoxyCodeLine{00007\ \textcolor{preprocessor}{\#include\ <QFuture>}}
\DoxyCodeLine{00008\ \textcolor{preprocessor}{\#include\ <QFutureWatcher>}}
\DoxyCodeLine{00009\ \textcolor{preprocessor}{\#include\ <QList>}}
\DoxyCodeLine{00010\ \textcolor{preprocessor}{\#include\ <QMutex>}}
\DoxyCodeLine{00011\ \textcolor{preprocessor}{\#include\ <QObject>}}
\DoxyCodeLine{00012\ \textcolor{preprocessor}{\#include\ <QQueue>}}
\DoxyCodeLine{00013\ \textcolor{preprocessor}{\#include\ <QString>}}
\DoxyCodeLine{00014\ }
\DoxyCodeLine{00019\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{struct_save_work_item}{SaveWorkItem}}\ \{}
\DoxyCodeLine{00020\ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{struct_save_work_item_a8792dd42008077c3531825d5554269e4}{pageNumber}};\ \ \ }
\DoxyCodeLine{00021\ \ \ QString\ \mbox{\hyperlink{struct_save_work_item_adbd59d33d1e015eeced57aa95f5d0341}{username}};\ }
\DoxyCodeLine{00022\ \ \ QList<ScrobbleData>\ \mbox{\hyperlink{struct_save_work_item_acba4a44ee9a7f1c272e1284066d704d2}{data}};\ }
\DoxyCodeLine{00023\ \};}
\DoxyCodeLine{00024\ }
\DoxyCodeLine{00033\ \textcolor{keyword}{class\ }\mbox{\hyperlink{class_database_manager_a40a0673ad81256715e17e20cb9d9964d}{DatabaseManager}}\ :\ \textcolor{keyword}{public}\ QObject\ \{}
\DoxyCodeLine{00034\ \ \ Q\_OBJECT}
\DoxyCodeLine{00035\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00043\ \ \ \textcolor{keyword}{explicit}\ \mbox{\hyperlink{class_database_manager_a40a0673ad81256715e17e20cb9d9964d}{DatabaseManager}}(\textcolor{keyword}{const}\ QString\ \&basePath\ =\ \textcolor{stringliteral}{"{}db"{}},}
\DoxyCodeLine{00044\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ QObject\ *parent\ =\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00045\ }
\DoxyCodeLine{00049\ \ \ \mbox{\hyperlink{class_database_manager_a4bfe6115d77c91afd99a669befb1ee70}{\string~DatabaseManager}}()\ \textcolor{keyword}{override}\ =\ \textcolor{keywordflow}{default};}
\DoxyCodeLine{00050\ }
\DoxyCodeLine{00062\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_database_manager_a9b3d156eab74325d1fe4648bbef65f2f}{saveScrobblesAsync}}(\textcolor{keywordtype}{int}\ pageNumber,\ \textcolor{keyword}{const}\ QString\ \&username,}
\DoxyCodeLine{00063\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ QList<ScrobbleData>\ \&scrobbles);}
\DoxyCodeLine{00064\ }
\DoxyCodeLine{00075\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_database_manager_af1f2185f8198761207f7d9f1c02adb9f}{loadScrobblesAsync}}(\textcolor{keyword}{const}\ QString\ \&username,\ \textcolor{keyword}{const}\ QDateTime\ \&from,}
\DoxyCodeLine{00076\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ QDateTime\ \&to);}
\DoxyCodeLine{00077\ }
\DoxyCodeLine{00086\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_database_manager_a936567e6c9c8a591e6181c81ddc36881}{loadAllScrobblesAsync}}(\textcolor{keyword}{const}\ QString\ \&username);}
\DoxyCodeLine{00087\ }
\DoxyCodeLine{00095\ \ \ qint64\ \mbox{\hyperlink{class_database_manager_a90487d0fc1090bd46f9a3670f3f656ee}{getLastSyncTimestamp}}(\textcolor{keyword}{const}\ QString\ \&username);}
\DoxyCodeLine{00096\ }
\DoxyCodeLine{00103\ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{class_database_manager_a686fe30df188bf6ef0776b9a5435d68b}{isSaveInProgress}}()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00104\ }
\DoxyCodeLine{00109\ \ \ QString\ \mbox{\hyperlink{class_database_manager_ae7d986e27dfa9b398745a85196fe02d1}{getBasePathInternal}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ m\_basePath;\ \}}
\DoxyCodeLine{00110\ }
\DoxyCodeLine{00111\ signals:}
\DoxyCodeLine{00117\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_database_manager_a3f956362243286458b59b6f2a1b5eafb}{pageSaveCompleted}}(\textcolor{keywordtype}{int}\ pageNumber);}
\DoxyCodeLine{00123\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_database_manager_aa28494d3af20b1ff6be2e558ebc7426e}{pageSaveFailed}}(\textcolor{keywordtype}{int}\ pageNumber,\ \textcolor{keyword}{const}\ QString\ \&error);}
\DoxyCodeLine{00124\ }
\DoxyCodeLine{00130\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_database_manager_aa02f698b3562c02503372d946dcb6b4f}{loadComplete}}(\textcolor{keyword}{const}\ QList<ScrobbleData>\ \&scrobbles);}
\DoxyCodeLine{00131\ }
\DoxyCodeLine{00136\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_database_manager_aee43a7a7f1e02a66b79c0f50f7949808}{loadError}}(\textcolor{keyword}{const}\ QString\ \&error);}
\DoxyCodeLine{00137\ }
\DoxyCodeLine{00143\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_database_manager_adcf2d12c21922b5938b9105a827d1958}{statusMessage}}(\textcolor{keyword}{const}\ QString\ \&message);}
\DoxyCodeLine{00144\ }
\DoxyCodeLine{00145\ \textcolor{keyword}{private}\ slots:}
\DoxyCodeLine{00150\ \ \ \textcolor{keywordtype}{void}\ handleLoadFinished();}
\DoxyCodeLine{00151\ }
\DoxyCodeLine{00152\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00157\ \ \ \textcolor{keywordtype}{void}\ startSaveTaskIfNotRunning();}
\DoxyCodeLine{00158\ }
\DoxyCodeLine{00164\ \ \ \textcolor{keywordtype}{void}\ saveTaskLoop();}
\DoxyCodeLine{00165\ }
\DoxyCodeLine{00177\ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ saveChunkSync(\textcolor{keyword}{const}\ QString\ \&basePath,\ \textcolor{keyword}{const}\ QString\ \&username,}
\DoxyCodeLine{00178\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ QList<ScrobbleData>\ \&scrobbles,}
\DoxyCodeLine{00179\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ QString\ \&errorMsg);}
\DoxyCodeLine{00180\ }
\DoxyCodeLine{00187\ \ \ \textcolor{keyword}{static}\ QDateTime\ getWeekStart(\textcolor{keyword}{const}\ QDateTime\ timestamp);}
\DoxyCodeLine{00197\ \ \ \textcolor{keyword}{static}\ QString\ getWeekFilePath(\textcolor{keyword}{const}\ QString\ \&userPath,}
\DoxyCodeLine{00198\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ QDateTime\ timestamp);}
\DoxyCodeLine{00199\ }
\DoxyCodeLine{00211\ \ \ \textcolor{keyword}{static}\ QList<ScrobbleData>\ loadScrobblesSync(\textcolor{keyword}{const}\ QString\ \&basePath,}
\DoxyCodeLine{00212\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ QString\ \&username,}
\DoxyCodeLine{00213\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ QDateTime\ \&from,}
\DoxyCodeLine{00214\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ QDateTime\ \&to,}
\DoxyCodeLine{00215\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ QString\ \&errorMsg);}
\DoxyCodeLine{00216\ }
\DoxyCodeLine{00225\ \ \ \textcolor{keyword}{static}\ QList<ScrobbleData>\ loadAllScrobblesSync(\textcolor{keyword}{const}\ QString\ \&basePath,}
\DoxyCodeLine{00226\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ QString\ \&username,}
\DoxyCodeLine{00227\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ QString\ \&errorMsg);}
\DoxyCodeLine{00228\ }
\DoxyCodeLine{00239\ \ \ \textcolor{keyword}{static}\ qint64\ findLastTimestampSync(\textcolor{keyword}{const}\ QString\ \&basePath,}
\DoxyCodeLine{00240\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ QString\ \&username);}
\DoxyCodeLine{00241\ }
\DoxyCodeLine{00242\ \ \ QString\ m\_basePath;}
\DoxyCodeLine{00243\ }
\DoxyCodeLine{00244\ \ \ QFutureWatcher<QList<ScrobbleData>>\ m\_loadWatcher;}
\DoxyCodeLine{00245\ \ \ QString\ m\_lastLoadError;}
\DoxyCodeLine{00246\ }
\DoxyCodeLine{00247\ \ \ \textcolor{keyword}{mutable}\ QMutex\ m\_saveQueueMutex;}
\DoxyCodeLine{00248\ \ \ QQueue<SaveWorkItem>\ m\_saveQueue;}
\DoxyCodeLine{00249\ \ \ QAtomicInteger<bool>\ m\_saveTaskRunning;}
\DoxyCodeLine{00250\ \};}
\DoxyCodeLine{00251\ }
\DoxyCodeLine{00252\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{//\ DATABASEMANAGER\_H}}

\end{DoxyCode}
